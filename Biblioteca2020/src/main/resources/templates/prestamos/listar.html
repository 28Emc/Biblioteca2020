<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head th:replace="layout/layout :: head"></head>

<body class="bg-light">

	<header th:replace="layout/layout :: header"></header>

	<div class="container-fluid my-3 px-5">

		<h1 class="text-warning py-2" th:text="${titulo}"></h1>

		<p sec:authorize="hasRole('ROLE_ADMIN') || hasRole('ROLE_EMPLEADO')">
			<a class="btn btn-primary btn-xs" th:href="@{/prestamos/crear}"><i
				class="fas fa-shield-alt"></i> Generar Préstamo</a>
		</p>
		
		<h1 th:if="${#lists.isEmpty(prestamos)}">No hay préstamos para mostrar</h1>
		
		<table class="table table-responsive"
			th:if="${not #lists.isEmpty(prestamos)}">
			<thead>
				<tr>
					<th>Id</th>
					<th>Libro</th>
					<th>Nombre Empleado</th>
					<th>Local Empleado</th>
					<th>Nombre Suscriptor</th>
					<th>Fecha Despacho</th>
					<th>Fecha Devolución/Anulación</th>
					<th>Observaciones</th>
					<th sec:authorize="!hasRole('ROLE_USER')">Estado</th>
					<th colspan="3" sec:authorize="!hasRole('ROLE_USER')">Opciones</th>
				</tr>
			</thead>
			<tbody>
				<tr th:each="prestamo: ${prestamos}">
					<td th:text="${prestamo.id}"></td>
					<td th:text="${prestamo.libro.titulo}+', '+${prestamo.libro.autor}"></td>
					<td
						th:text="${prestamo.empleado.nombres}+', '+${prestamo.empleado.apellidos}"></td>
					<td th:text="${prestamo.empleado.local.direccion}"></td>
					<td
						th:text="${prestamo.usuario.nombres}+', '+${prestamo.usuario.apellidos}"></td>
					<td th:text="${prestamo.fecha_despacho}"></td>
					<td th:text="${prestamo.fecha_devolucion}"></td>
					<td data-toggle="tooltip" data-placement="top"
						th:title="${prestamo.observaciones}" class="text-center"><i
						class="fas fa-search fa-2x"></i></td>

					<th:block th:with="estado=${prestamo.devolucion}"
						sec:authorize="!hasRole('ROLE_USER')">
						<td th:if="${estado}">
							<h5>
								<span class="badge badge-success" th:text="'Préstamo Terminado'"></span>
							</h5>
						</td>
						<td th:if="${estado}"><a
							class="disabled btn btn-secondary btn-xs" href="#"> <i
								class="fas fa-shield-alt"></i> Devolver Libro
						</a></td>
						<td th:if="${estado}"><a
							class="disabled btn btn-secondary btn-xs" href="#"><i
								class="fas fa-shield-alt"></i> Anular Préstamo</a></td>
						<td th:unless="${estado}">
							<h5>
								<span class="badge badge-danger text-light"
									th:text="'Libro Sin devolver'"></span>
							</h5>
						</td>
						<td th:unless="${estado}"><a class="btn btn-info btn-xs"
							th:href="@{/prestamos/devolverLibro/}+${prestamo.id}"
							onclick="return confirm('¿Seguro de querer validar la devolución del libro?');"><i
								class="fas fa-shield-alt"></i> Devolver Libro</a></td>
						<td th:unless="${estado}"><a class="btn btn-warning btn-xs"
							th:href="@{/prestamos/anularPrestamo/}+${prestamo.id}"
							onclick="return confirm('Seguro de querer anular el préstamo?');"><i
								class="fas fa-shield-alt"></i> Anular Préstamo</a></td>
					</th:block>
				</tr>
			</tbody>
		</table>

	</div>

	<footer th:replace="layout/layout :: footer"></footer>
</body>
</html>